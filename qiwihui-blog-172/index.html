<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> Sui 数据类型讲解 · QIWIHUI</title><meta name="description" content="Sui 数据类型讲解 - qiwihui"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/nella.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-8935595858652656",
enable_page_level_ads: true
});
</script><link rel="search" type="application/opensearchdescription+xml" href="https://qiwihui.com/atom.xml" title="QIWIHUI"><meta property="og:site_name" content="QIWIHUI"><meta property="og:url" content="https://qiwihui.com/qiwihui-blog-172/index.html"><meta property="og:title" content="Sui 数据类型讲解"><meta property="og:description" content="Sui 数据类型讲解"><meta property="og:type" content="article"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/images/avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/search/" target="_self" class="nav-list-link">SEARCH</a></li><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/projects/" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/links/" target="_self" class="nav-list-link">LINKS</a></li><!--li.nav-list-item--><!--    a.nav-list-link(class="search" href=url_for("search") target="_self") SEARCH--></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">Sui 数据类型讲解</h1><div class="post-info">May 15, 2024<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a href="/categories/%E6%8A%80%E6%9C%AF/" class="post-category">#技术</a><span>35 min. read</span></div><div class="post-content"><p>这篇文章中，我们将介绍 Sui 中常见的数据结构，这些结构包含 Sui Move 和 Sui Framework 中提供的基础类型和数据结构，理解和熟悉这些数据结构对于 Sui Move 的理解和应用大有裨益。</p>
<p>首先，我们先快速复习一下 Sui Move 中使用到的基础类型。</p>
<h3><span id="wu-fu-hao-zheng-xing-integer">无符号整型（Integer）</span></h3>
<p>Move 包含六种无符号整型：<code>u8</code>，<code>u16</code> <code>u32</code>，<code>u64</code>，<code>u128</code>和 <code>u256</code>。值的范围从 0 到 与类型大小相关的最大值。</p>
<p>这些类型的字面值为数字序列（例如 112）或十六进制文字，例如 <code>0xFF</code>。 字面值的类型可以选择添加为后缀，例如 <code>112u8</code>。 如果未指定类型，编译器将尝试从使用文字的上下文中推断类型。 如果无法推断类型，则假定为 <code>u64</code>。</p>
<p>对无符号整型支持的运算包括：</p>
<ul>
<li>算数运算： <code>+</code> <code>-</code>  <code>*</code>  <code>%</code> <code>/</code></li>
<li>位运算： <code>&amp;</code> <code>|</code> <code>^</code>  <code>&gt;&gt;</code> <code>&lt;&lt;</code></li>
<li>比较运算： <code>&gt;</code> <code>&lt;</code> <code>&gt;=</code> <code>&lt;=</code>  <code>==</code> <code>!=</code></li>
<li>类型转换： <code>as</code>
<ul>
<li>注意，类型转换不会截断，因此如果结果对于指定类型而言太大，转换将中止。</li>
</ul>
</li>
</ul>
<p>简单示例：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a: <span class="built_in">u64</span> = <span class="number">4</span>;</span><br><span class="line"><span class="keyword">let</span> b = <span class="number">2u64</span>;</span><br><span class="line"><span class="keyword">let</span> hex_u64: <span class="built_in">u64</span> = <span class="number">0xCAFE</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">assert!</span>(a+b==<span class="number">6</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">assert!</span>(a-b==<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">assert!</span>(a*b==<span class="number">8</span>, <span class="number">0</span>);</span><br><span class="line"><span class="built_in">assert!</span>(a/b==<span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> complex_u8 = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">let</span> _unused = <span class="number">10</span> &lt;&lt; complex_u8;</span><br><span class="line"></span><br><span class="line">(b <span class="keyword">as</span> <span class="built_in">u128</span>)</span><br></pre></td></tr></table></figure>
<h3><span id="bu-er-lei-xing-bool">布尔类型（Bool）</span></h3>
<p>Move 布尔值包含两种，<code>true</code> 和 <code>false</code> 。支持与 <code>&amp;&amp;</code>，或<code>||</code>  和非 <code>!</code> 运算。可以用于 Move 的控制流和 <code>assert!</code> 中。 <code>assert!</code> 是 Move 提供的用于断言，当判断的值是 <code>false</code> 时，程序会抛出错误并停止。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">bool</span>) &#123; ... &#125;</span><br><span class="line"><span class="keyword">while</span> (<span class="built_in">bool</span>) &#123; .. &#125;</span><br><span class="line"><span class="built_in">assert!</span>(<span class="built_in">bool</span>, <span class="built_in">u64</span>)</span><br></pre></td></tr></table></figure>
<h3><span id="di-zhi-address">地址（Address）</span></h3>
<p>address 也是 Move 的原生类型，可以在地址下保存模块和资源。Sui 中地址的长度为 20 字节。</p>
<p>在表达式中，地址需要使用前缀 <code>@</code> ，例如：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> a1: address = @<span class="number">0xDEADBEEF</span>; <span class="comment">// shorthand for 0x00000000000000000000000000000000DEADBEEF</span></span><br><span class="line"><span class="keyword">let</span> a2: address = @<span class="number">0x0000000000000000000000000000000000000002</span>;</span><br></pre></td></tr></table></figure>
<h3><span id="tuples-he-unit">Tuples 和 Unit</span></h3>
<p>Tuples 和 Unit <code>()</code> 在 Move 中主要用作函数返回值。只支持解构（destructuring）运算。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::tuples &#123;</span><br><span class="line">    <span class="comment">// all 3 of these functions are equivalent</span></span><br><span class="line">    fun returns_unit() &#123;&#125;</span><br><span class="line">    fun returns_2_values(): (<span class="built_in">bool</span>, <span class="built_in">bool</span>) &#123; (<span class="literal">true</span>, <span class="literal">false</span>) &#125;</span><br><span class="line">    fun returns_4_values(x: &amp;<span class="built_in">u64</span>): (&amp;<span class="built_in">u64</span>, <span class="built_in">u8</span>, <span class="built_in">u128</span>, vector&lt;<span class="built_in">u8</span>&gt;) &#123; (x, <span class="number">0</span>, <span class="number">1</span>, <span class="string">b"foobar"</span>) &#125;</span><br><span class="line"></span><br><span class="line">    fun examples(cond: <span class="built_in">bool</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> () = ();</span><br><span class="line">        <span class="keyword">let</span> (x, y): (<span class="built_in">u8</span>, <span class="built_in">u64</span>) = (<span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> (a, b, c, d) = (@<span class="number">0x0</span>, <span class="number">0</span>, <span class="literal">false</span>, <span class="string">b""</span>);</span><br><span class="line"></span><br><span class="line">        () = ();</span><br><span class="line">        (x, y) = <span class="keyword">if</span> (cond) (<span class="number">1</span>, <span class="number">2</span>) <span class="keyword">else</span> (<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line">        (a, b, c, d) = (@<span class="number">0x1</span>, <span class="number">1</span>, <span class="literal">true</span>, <span class="string">b"1"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun examples_with_function_calls() &#123;</span><br><span class="line">        <span class="keyword">let</span> () = returns_unit();</span><br><span class="line">        <span class="keyword">let</span> (x, y): (<span class="built_in">bool</span>, <span class="built_in">bool</span>) = returns_2_values();</span><br><span class="line">        <span class="keyword">let</span> (a, b, c, d) = returns_4_values(&amp;<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        () = returns_unit();</span><br><span class="line">        (x, y) = returns_2_values();</span><br><span class="line">        (a, b, c, d) = returns_4_values(&amp;<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来，我们从 Vector 开始，介绍 Sui 和 Sui Framework 中支持的集合类型。</p>
<h3><span id="shu-zu-vector">数组（Vector）</span></h3>
<p><code>vector&lt;T&gt;</code> 是 Move 提供的唯一的原生集合类型。<code>vector&lt;T&gt;</code> 是由一组相同类型的值组成的数组，比如 <code>vector&lt;u64&gt;</code>， <code>vector&lt;address&gt;</code> 等。</p>
<p><code>vector</code> 支持的主要操作有：</p>
<ul>
<li>末尾添加元素：<code>push_back</code></li>
<li>末尾删除元素： <code>pop_back</code></li>
<li>读取或者修改： <code>borrow</code> ，<code>borrow_mut</code></li>
<li>判断是否包含： <code>contains</code></li>
<li>交换元素： <code>swap</code></li>
<li>读取元素索引： <code>index_of</code></li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::vectors &#123;</span><br><span class="line">    <span class="keyword">use</span> std::vector;</span><br><span class="line"></span><br><span class="line">    public entry fun example() &#123;</span><br><span class="line">        <span class="keyword">let</span> v = vector::empty&lt;<span class="built_in">u64</span>&gt;();</span><br><span class="line">        vector::push_back(&amp;<span class="keyword">mut</span> v, <span class="number">5</span>);</span><br><span class="line">        vector::push_back(&amp;<span class="keyword">mut</span> v, <span class="number">6</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(vector::contains(&amp;<span class="keyword">mut</span> v, &amp;<span class="number">5</span>), <span class="number">42</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">let</span> (exists, index) = vector::index_of(&amp;<span class="keyword">mut</span> v, &amp;<span class="number">5</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(exists, <span class="number">42</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(index == <span class="number">0</span>, <span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(*vector::borrow(&amp;v, <span class="number">0</span>) == <span class="number">5</span>, <span class="number">42</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(*vector::borrow(&amp;v, <span class="number">1</span>) == <span class="number">6</span>, <span class="number">42</span>);</span><br><span class="line"></span><br><span class="line">        vector::swap(&amp;<span class="keyword">mut</span> v, <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(vector::pop_back(&amp;<span class="keyword">mut</span> v) == <span class="number">5</span>, <span class="number">42</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(vector::pop_back(&amp;<span class="keyword">mut</span> v) == <span class="number">6</span>, <span class="number">42</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并运行示例：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 编译并发布</span></span><br><span class="line">sui client publish . --gas-budget 300000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取上一步编译得到的包的ID</span></span><br><span class="line"><span class="built_in">export</span> package_id=0xee2961ee26916285ebef57c68caaa5f67a3d8dbd</span><br><span class="line"></span><br><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> example \</span><br><span class="line">  --module vectors \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --gas-budget 30000</span><br></pre></td></tr></table></figure>
<p>下面我们介绍几种基于 <code>vector</code>  的数据类型。</p>
<h3><span id="zi-fu-chuan-string">字符串（String）</span></h3>
<p>Move 没有字符串的原生类型，但它使用 <code>vector&lt;u8&gt;</code> 表示字节数组。目前， <code>vector&lt;u8&gt;</code> 字面量有两种：字节字符串（byte strings）和十六进制字符串（hex strings）。</p>
<p>字节字符串是以 <code>b</code> 为前缀的字符串文字，例如 <code>b&quot;Hello!\n&quot;</code>。</p>
<p>十六进制字符串是以 <code>x</code> 为前缀的字符串文字，例如 <code>x&quot;48656C6C6F210A&quot;</code> 。每一对字节的范围从 <code>00</code> 到 <code>FF</code>，表示一个十六进制的 <code>u8</code>。因此我们可以知道： <code>b&quot;Hello&quot; == x&quot;48656C6C6F&quot;</code>。</p>
<p>在 <code>vector&lt;u8&gt;</code> 的基础上，Move 提供了 <code>string</code> 包处理 UTF8 字符串的操作。</p>
<p>我们以创建 Name NFT 的为例：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::strings &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;sender, TxContext&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 使用 std::string 作为 UTF-8 字符串</span></span><br><span class="line">    <span class="keyword">use</span> std::string::&#123;<span class="keyword">Self</span>, <span class="built_in">String</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 保存 String 类型</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Name</span></span> has key, store &#123;</span><br><span class="line">        id: UID,</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// String 类型</span></span><br><span class="line">        name: <span class="built_in">String</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun create_name(</span><br><span class="line">        name_bytes: vector&lt;<span class="built_in">u8</span>&gt;, ctx: &amp;<span class="keyword">mut</span> TxContext</span><br><span class="line">    ): Name &#123;</span><br><span class="line">        Name &#123;</span><br><span class="line">            id: object::new(ctx),</span><br><span class="line">            name: string::utf8(name_bytes)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 传入原始字节（raw bytes）来创建</span></span><br><span class="line">    public entry fun issue_name_nft(</span><br><span class="line">        name_bytes: vector&lt;<span class="built_in">u8</span>&gt;, ctx: &amp;<span class="keyword">mut</span> TxContext</span><br><span class="line">    ) &#123;</span><br><span class="line">        transfer::transfer(</span><br><span class="line">            create_name(name_bytes, ctx),</span><br><span class="line">            sender(ctx)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后命令行中调用：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sui client call \</span><br><span class="line">  --<span class="keyword">function</span> issue_name_nft \</span><br><span class="line">  --module strings \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args <span class="string">"my_nft"</span> --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 部分输出结果</span></span><br><span class="line"></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0xf53891c8d200125bcfdba69557b158395bdf9390 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br><span class="line">Mutated Objects:</span><br><span class="line">  - ID: 0xd1de857a7a5452a73c9c176cd7c9db1b06671723 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br></pre></td></tr></table></figure>
<p>可以在 Transaction Effects 中看到新创建的对象，ID 为 <code>0xf53891c8d200125bcfdba69557b158395bdf9390</code>，通过 Sui 提供的 RPC-API 接口 <code>sui_getObject</code> 可以看到其中保存的内容：</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">curl -H 'Content-Type: application/json' https://fullnode.devnet.sui.io:443 -d '&#123;</span><br><span class="line">  "jsonrpc": "2.0",</span><br><span class="line">  "id": 1,</span><br><span class="line">  "method": "sui_getObject",</span><br><span class="line">  "params":[</span><br><span class="line">      <span class="string">"0xf53891c8d200125bcfdba69557b158395bdf9390"</span></span><br><span class="line">  ]</span><br><span class="line">&#125;'</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: &#123;</span><br><span class="line">        <span class="attr">"status"</span>: <span class="string">"Exists"</span>,</span><br><span class="line">        <span class="attr">"details"</span>: &#123;</span><br><span class="line">            <span class="attr">"data"</span>: &#123;</span><br><span class="line">                <span class="attr">"dataType"</span>: <span class="string">"moveObject"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"0xee2961ee26916285ebef57c68caaa5f67a3d8dbd::strings::Name"</span>,</span><br><span class="line">                <span class="attr">"has_public_transfer"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">"fields"</span>: &#123;</span><br><span class="line">                    <span class="attr">"id"</span>: &#123;</span><br><span class="line">                        <span class="attr">"id"</span>: <span class="string">"0xf53891c8d200125bcfdba69557b158395bdf9390"</span></span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="attr">"name"</span>: <span class="string">"my_nft"</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"owner"</span>: &#123;</span><br><span class="line">                <span class="attr">"AddressOwner"</span>: <span class="string">"0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0"</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">"previousTransaction"</span>: <span class="string">"7AfcBmJCioSbdZD6ZdYU2iUuGiSc62AuhZn7Yi3TfLDa"</span>,</span><br><span class="line">            <span class="attr">"storageRebate"</span>: <span class="number">13</span>,</span><br><span class="line">            <span class="attr">"reference"</span>: &#123;</span><br><span class="line">                <span class="attr">"objectId"</span>: <span class="string">"0xf53891c8d200125bcfdba69557b158395bdf9390"</span>,</span><br><span class="line">                <span class="attr">"version"</span>: <span class="number">1614</span>,</span><br><span class="line">                <span class="attr">"digest"</span>: <span class="string">"/SEDlnh4xXq//ZGOCZVQM5QfyR2fPzJWaYWELhrSn2o="</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="vecmap-he-vecset">VecMap 和 VecSet</span></h3>
<p>Sui 在 <code>vector</code> 的基础上实现了两种数据结构，映射 <code>vec_map</code> 和集合 <code>vec_set</code> 。</p>
<p><code>vec_map</code> 是一种映射结构，保证不包含重复的键，但是条目按照插入顺序排列，而不是按键的顺序。所有的操作时间复杂度为 <code>0(N)</code>，N 为映射的大小。<code>vec_map</code> 只是为了提供方便的操作映射的接口，如果需要保存大型的映射，或者是需要按键的顺序排序的映射都需要另外处理。可以考虑使用之后介绍的 <code>table</code> 数据结构。</p>
<p>主要操作包括：</p>
<ul>
<li>创建空映射: <code>empty</code></li>
<li>插入键值对： <code>insert</code></li>
<li>获取键对应的值： <code>get</code>， <code>get_mut</code></li>
<li>删除键： <code>remove</code></li>
<li>判断是否包含键： <code>contains</code></li>
<li>映射大小： <code>size</code></li>
<li>将映射转为键值对的数组： <code>into_keys_values</code></li>
<li>获取映射键的数组： <code>keys</code></li>
<li>删除空映射： <code>destroy_empty</code></li>
<li>通过插入的顺序索引键值对： <code>get_entry_by_idx</code>，<code>get_entry_by_idx_mut</code></li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::v_map &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::vec_map;</span><br><span class="line">    <span class="keyword">use</span> std::vector;</span><br><span class="line"></span><br><span class="line">    public entry fun example() &#123;</span><br><span class="line">        <span class="keyword">let</span> m = vec_map::empty();</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">let</span> v = i + <span class="number">5</span>;</span><br><span class="line">            vec_map::insert(&amp;<span class="keyword">mut</span> m, k, v);</span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">assert!</span>(!vec_map::is_empty(&amp;m), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(vec_map::size(&amp;m) == <span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// make sure the elements are as expected in all of the getter APIs we expose</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            <span class="built_in">assert!</span>(vec_map::contains(&amp;m, &amp;k), <span class="number">2</span>);</span><br><span class="line">            <span class="keyword">let</span> v = *vec_map::get(&amp;m, &amp;k);</span><br><span class="line">            <span class="built_in">assert!</span>(v == i + <span class="number">5</span>, <span class="number">3</span>);</span><br><span class="line">            <span class="built_in">assert!</span>(vec_map::get_idx(&amp;m, &amp;k) == i, <span class="number">4</span>);</span><br><span class="line">            <span class="keyword">let</span> (other_k, other_v) = vec_map::get_entry_by_idx(&amp;m, i);</span><br><span class="line">            <span class="built_in">assert!</span>(*other_k == k, <span class="number">5</span>);</span><br><span class="line">            <span class="built_in">assert!</span>(*other_v == v, <span class="number">6</span>);</span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 移出所有元素</span></span><br><span class="line">        <span class="keyword">let</span> (keys, values) = vec_map::into_keys_values(copy m);</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">let</span> (other_k, v) = vec_map::remove(&amp;<span class="keyword">mut</span> m, &amp;k);</span><br><span class="line">            <span class="built_in">assert!</span>(k == other_k, <span class="number">7</span>);</span><br><span class="line">            <span class="built_in">assert!</span>(v == i + <span class="number">5</span>, <span class="number">8</span>);</span><br><span class="line">            <span class="built_in">assert!</span>(*vector::borrow(&amp;keys, i) == k, <span class="number">9</span>);</span><br><span class="line">            <span class="built_in">assert!</span>(*vector::borrow(&amp;values, i) == v, <span class="number">10</span>);</span><br><span class="line"></span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>vec_set</code> 结构保证其中不包含重复的键。所有的操作时间复杂度为 <code>O(N)</code>，N 为映射的大小。同样， <code>vec_set</code> 提供了方便的集合操作接口，按插入顺序进行排序，如果需要使用按键进行排序的集合，也需要另外处理。</p>
<p>主要操作包括：</p>
<ul>
<li>创建空集合: <code>empty</code></li>
<li>插入元素： <code>insert</code></li>
<li>删除元素： <code>remove</code></li>
<li>判断是否包含元素： <code>contains</code></li>
<li>集合大小： <code>size</code></li>
<li>将集合转为元素的数组： <code>into_keys</code></li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::v_set &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::vec_set;</span><br><span class="line">    <span class="keyword">use</span> std::vector;</span><br><span class="line"></span><br><span class="line">    public entry fun example() &#123;</span><br><span class="line">        <span class="keyword">let</span> m = vec_set::empty();</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            vec_set::insert(&amp;<span class="keyword">mut</span> m, k);</span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="built_in">assert!</span>(!vec_set::is_empty(&amp;m), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(vec_set::size(&amp;m) == <span class="number">10</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// make sure the elements are as expected in all of the getter APIs we expose</span></span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            <span class="built_in">assert!</span>(vec_set::contains(&amp;m, &amp;k), <span class="number">2</span>);</span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// 移出所有元素</span></span><br><span class="line">        <span class="keyword">let</span> keys = vec_set::into_keys(copy m);</span><br><span class="line">        <span class="keyword">let</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; <span class="number">10</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> k = i + <span class="number">2</span>;</span><br><span class="line">            vec_set::remove(&amp;<span class="keyword">mut</span> m, &amp;k);</span><br><span class="line">            <span class="built_in">assert!</span>(*vector::borrow(&amp;keys, i) == k, <span class="number">9</span>);</span><br><span class="line">            i = i + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="you-xian-dui-lie-priorityqueue">优先队列（PriorityQueue）</span></h3>
<p>还有一种基于 <code>vector</code> 构建的数据结构：优先队列，他使用基于 <code>vector</code> 实现的大顶堆（max heap）来实现。</p>
<p>大顶堆是一种二叉树结构，每个节点的值都大于或等于其左右孩子节点的值，这样，这个二叉树的根节点始终都是所有节点中值最大的节点。</p>
<p>在优先队列中，我们为每一个节点赋予一个权重，我们基于权重构建一个大顶堆，从大顶堆顶部弹出根节点则为权重最大的节点。这样就形成过了一个按优先级弹出的队列。</p>
<p>优先队列主要包含的操作为：</p>
<ul>
<li>创建条目列表： <code>create_entries</code> ，结果作为 <code>new</code> 方法参数</li>
<li>创建： <code>new</code></li>
<li>插入： <code>insert</code></li>
<li>弹出最大： <code>pop_max</code></li>
</ul>
<p>示例：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::pq &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::priority_queue::&#123;PriorityQueue, pop_max, create_entries, new, insert&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// 检查弹出的最大值及其权重</span></span><br><span class="line">    fun check_pop_max(h: &amp;<span class="keyword">mut</span> PriorityQueue&lt;<span class="built_in">u64</span>&gt;, expected_priority: <span class="built_in">u64</span>, expected_value: <span class="built_in">u64</span>) &#123;</span><br><span class="line">        <span class="keyword">let</span> (priority, value) = pop_max(h);</span><br><span class="line">        <span class="built_in">assert!</span>(priority == expected_priority, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(value == expected_value, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun example() &#123;</span><br><span class="line">        <span class="keyword">let</span> h = new(create_entries(vector[<span class="number">3</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">2</span>], vector[<span class="number">10</span>, <span class="number">20</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">50</span>, <span class="number">60</span>]));</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">5</span>, <span class="number">50</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">4</span>, <span class="number">30</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">3</span>, <span class="number">10</span>);</span><br><span class="line">        insert(&amp;<span class="keyword">mut</span> h, <span class="number">7</span>, <span class="number">70</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">7</span>, <span class="number">70</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">2</span>, <span class="number">40</span>);</span><br><span class="line">        insert(&amp;<span class="keyword">mut</span> h, <span class="number">0</span>, <span class="number">80</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">2</span>, <span class="number">60</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">1</span>, <span class="number">20</span>);</span><br><span class="line">        check_pop_max(&amp;<span class="keyword">mut</span> h, <span class="number">0</span>, <span class="number">80</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="jie-gou-ti-struct">结构体（Struct）</span></h3>
<p>Move语言中，结构体是包含类型化字段的用户定义数据结构。 结构可以存储任何非引用类型，包括其他结构。示例：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::structs &#123;</span><br><span class="line">    <span class="comment">// 二维平面点</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Point</span></span> has copy, <span class="built_in">drop</span>, store &#123;</span><br><span class="line">        x: <span class="built_in">u64</span>,</span><br><span class="line">        y: <span class="built_in">u64</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 圆</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Circle</span></span> has copy, <span class="built_in">drop</span>, store &#123;</span><br><span class="line">        center: Point,</span><br><span class="line">        radius: <span class="built_in">u64</span>,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建结构体</span></span><br><span class="line">    public fun new_point(x: <span class="built_in">u64</span>, y: <span class="built_in">u64</span>): Point &#123;</span><br><span class="line">        Point &#123;</span><br><span class="line">            x, y</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 访问结构体数据</span></span><br><span class="line">    public fun point_x(p: &amp;Point): <span class="built_in">u64</span> &#123;</span><br><span class="line">        p.x</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public fun point_y(p: &amp;Point): <span class="built_in">u64</span> &#123;</span><br><span class="line">        p.y</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun abs_sub(a: <span class="built_in">u64</span>, b: <span class="built_in">u64</span>): <span class="built_in">u64</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (a &lt; b) &#123;</span><br><span class="line">            b - a</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            a - b</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算点之间的距离</span></span><br><span class="line">    public fun dist_squared(p1: &amp;Point, p2: &amp;Point): <span class="built_in">u64</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> dx = abs_sub(p1.x, p2.x);</span><br><span class="line">        <span class="keyword">let</span> dy = abs_sub(p1.y, p2.y);</span><br><span class="line">        dx * dx + dy * dy</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public fun new_circle(center: Point, radius: <span class="built_in">u64</span>): Circle &#123;</span><br><span class="line">        Circle &#123; center, radius &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 计算两个圆之间是否相交</span></span><br><span class="line">    public fun overlaps(c1: &amp;Circle, c2: &amp;Circle): <span class="built_in">bool</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> d = dist_squared(&amp;c1.center, &amp;c2.center);</span><br><span class="line">        <span class="keyword">let</span> r1 = c1.radius;</span><br><span class="line">        <span class="keyword">let</span> r2 = c2.radius;</span><br><span class="line">        d * d &lt;= r1 * r1 + <span class="number">2</span> * r1 * r2 + r2 * r2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="dui-xiang-object">对象（Object）</span></h3>
<p>对象是 Sui Move 中新引入的概念，也是 Sui 安全和高并发等众多特性的基础。定义一个对象，需要为结构体添加 <code>key</code> 能力，同时结构体的第一个字段必须是 <code>UID</code> 类型的 id。</p>
<p>对象结构中除了可以使用基础数据结构外，也可以包含另一个对象，即对象可以进行包装，在一个对象中使用另一个对象。</p>
<p>对象有不同的所有权形式，可以存放在一个地址下面，也可以设置成不可变对象或者全局对象。不可变对象永远不能被修改，转移或者删除，因此它不属于任何人，但也可以被任何人访问。比如合约包对象，Coin Metadata 对象。</p>
<p>我们可以通过 <code>transfer</code> 包中的方法对对象进行处理：</p>
<ul>
<li><code>transfer</code>：将对象放到某个地址下</li>
<li><code>freeze_object</code>：创建不可变对象</li>
<li><code>share_object</code>：创建共享对象</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::objects &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;<span class="keyword">Self</span>, TxContext&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ColorObject</span></span> has key &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        red: <span class="built_in">u8</span>,</span><br><span class="line">        green: <span class="built_in">u8</span>,</span><br><span class="line">        blue: <span class="built_in">u8</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fun new(red: <span class="built_in">u8</span>, green: <span class="built_in">u8</span>, blue: <span class="built_in">u8</span>, ctx: &amp;<span class="keyword">mut</span> TxContext): ColorObject &#123;</span><br><span class="line">        ColorObject &#123;</span><br><span class="line">            id: object::new(ctx),</span><br><span class="line">            red,</span><br><span class="line">            green,</span><br><span class="line">            blue,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun create(red: <span class="built_in">u8</span>, green: <span class="built_in">u8</span>, blue: <span class="built_in">u8</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> color_object = new(red, green, blue, ctx);</span><br><span class="line">        transfer::transfer(color_object, tx_context::sender(ctx))</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public fun get_color(<span class="keyword">self</span>: &amp;ColorObject): (<span class="built_in">u8</span>, <span class="built_in">u8</span>, <span class="built_in">u8</span>) &#123;</span><br><span class="line">        (<span class="keyword">self</span>.red, <span class="keyword">self</span>.green, <span class="keyword">self</span>.blue)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/// Copies the values of `from_object` into `into_object`.</span></span><br><span class="line">    public entry fun copy_into(from_object: &amp;ColorObject, into_object: &amp;<span class="keyword">mut</span> ColorObject) &#123;</span><br><span class="line">        into_object.red = from_object.red;</span><br><span class="line">        into_object.green = from_object.green;</span><br><span class="line">        into_object.blue = from_object.blue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun delete(object: ColorObject) &#123;</span><br><span class="line">        <span class="keyword">let</span> ColorObject &#123; id, red: _, green: _, blue: _ &#125; = object;</span><br><span class="line">        object::delete(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun transfer(object: ColorObject, recipient: address) &#123;</span><br><span class="line">        transfer::transfer(object, recipient)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun freeze_object(object: ColorObject) &#123;</span><br><span class="line">        transfer::freeze_object(object)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun create_shareable(red: <span class="built_in">u8</span>, green: <span class="built_in">u8</span>, blue: <span class="built_in">u8</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> color_object = new(red, green, blue, ctx);</span><br><span class="line">        transfer::share_object(color_object)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun create_immutable(red: <span class="built_in">u8</span>, green: <span class="built_in">u8</span>, blue: <span class="built_in">u8</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> color_object = new(red, green, blue, ctx);</span><br><span class="line">        transfer::freeze_object(color_object)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun update(</span><br><span class="line">        object: &amp;<span class="keyword">mut</span> ColorObject,</span><br><span class="line">        red: <span class="built_in">u8</span>, green: <span class="built_in">u8</span>, blue: <span class="built_in">u8</span>,</span><br><span class="line">    ) &#123;</span><br><span class="line">        object.red = red;</span><br><span class="line">        object.green = green;</span><br><span class="line">        object.blue = blue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后调用：</p>
<ol>
<li>创建共享对象</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> create_shareable \</span><br><span class="line">  --module objects \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args 1 2 3 --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果输出</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 , Owner: Shared</span><br></pre></td></tr></table></figure>
<ol>
<li>创建不可变对象</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> create_immutable \</span><br><span class="line">  --module objects \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args 1 2 3 --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果输出</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0x88f8f210635af6503a8a07835ef12e147fa60aa3 , Owner: Immutable</span><br></pre></td></tr></table></figure>
<ol>
<li>将对象放入某个地址下</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> create \</span><br><span class="line">  --module objects \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args 1 2 3 --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果输出</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0xf36144c71cde87c1e00f1bf00ee44653bc05228c , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br></pre></td></tr></table></figure>
<p>可以看到，不同所有权类型的对象会在创建时显示不同的类型结果。</p>
<ol>
<li>修改共享对象或者是地址所拥有的对象：传入对象 ID 作为参数</li>
</ol>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> update \</span><br><span class="line">  --module objects \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 4 5 6 --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 结果输出</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Mutated Objects:</span><br><span class="line">  - ID: 0x3b25eba3bf836088b56bdfd36e39ec440db8bf59 , Owner: Shared</span><br></pre></td></tr></table></figure>
<p>可以在结果中看到 <code>Mutated Objects</code> 中对象已经发生了变化。</p>
<h3><span id="dynamic-field-he-dynamic-object-field">Dynamic field 和 Dynamic object field</span></h3>
<p>对象虽然可以进行包装，但是也有一些局限，一是对象中的字段是有限的，在结构体定义是已经确定；二是包含其他对象的对象可能非常大，可能会导致交易 gas 很高，Sui 默认结构体大小限制为 2MB；再者，当遇到要储存不一样类型的对象集合时，问题就会比较棘手，Move 中的 <code>vector</code> 只能存储相同的类型的数据。</p>
<p>因此，Sui 提供了 dynamic field，可以使用任意名字做字段，也可以动态添加和删除。唯一影响的是 gas 的消耗。</p>
<p>dynamic field 包含两种类型，field 和 Object field，区别在于，field 可以存储任何有 <code>store</code> 能力的值，但是如果是对象的话，对象会被认为是被包装而不能通过 ID 被外部工具（浏览器，钱包等）访问；而 Object field 的值必须是对象（有 <code>key</code> 能力且第一个字段是 <code>id: UID</code>），对象仍然能从外部工具通过 ID 访问。</p>
<p>dynamic filed 的名称可以是任何拥有 <code>copy</code>，<code>drop</code> 和 <code>store</code> 能力的值，这些值包括 Move 中的基本类型（整数，布尔值，字节串），以及拥有 <code>copy</code>，<code>drop</code> 和 <code>store</code> 能力的结构体。</p>
<p>下面我们通过例子来看看具体的操作：</p>
<ul>
<li>添加字段： <code>add</code></li>
<li>访问和修改字段： <code>borrow</code>， <code>borow_mut</code></li>
<li>删除字段</li>
</ul>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::fields &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::dynamic_object_field <span class="keyword">as</span> dof;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;<span class="keyword">Self</span>, TxContext&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Parent</span></span> has key &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Child</span></span> has key, store &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        count: <span class="built_in">u64</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun initialize(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        transfer::transfer(Parent &#123; id: object::new(ctx) &#125;, tx_context::sender(ctx));</span><br><span class="line">        transfer::transfer(Child &#123; id: object::new(ctx), count: <span class="number">0</span> &#125;, tx_context::sender(ctx));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun add_child(parent: &amp;<span class="keyword">mut</span> Parent, child: Child) &#123;</span><br><span class="line">        dof::add(&amp;<span class="keyword">mut</span> parent.id, <span class="string">b"child"</span>, child);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun mutate_child(child: &amp;<span class="keyword">mut</span> Child) &#123;</span><br><span class="line">        child.count = child.count + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun mutate_child_via_parent(parent: &amp;<span class="keyword">mut</span> Parent) &#123;</span><br><span class="line">        mutate_child(dof::borrow_mut&lt;vector&lt;<span class="built_in">u8</span>&gt;, Child&gt;(</span><br><span class="line">            &amp;<span class="keyword">mut</span> parent.id,</span><br><span class="line">            <span class="string">b"child"</span>,</span><br><span class="line">        ));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun delete_child(parent: &amp;<span class="keyword">mut</span> Parent) &#123;</span><br><span class="line">        <span class="keyword">let</span> Child &#123; id, count: _ &#125; = dof::remove&lt;vector&lt;<span class="built_in">u8</span>&gt;, Child&gt;(</span><br><span class="line">            &amp;<span class="keyword">mut</span> parent.id,</span><br><span class="line">            <span class="string">b"child"</span>,</span><br><span class="line">        );</span><br><span class="line">        object::delete(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun reclaim_child(parent: &amp;<span class="keyword">mut</span> Parent, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> child = dof::remove&lt;vector&lt;<span class="built_in">u8</span>&gt;, Child&gt;(</span><br><span class="line">            &amp;<span class="keyword">mut</span> parent.id,</span><br><span class="line">            <span class="string">b"child"</span>,</span><br><span class="line">        );</span><br><span class="line">        transfer::transfer(child, tx_context::sender(ctx));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并调用 <code>initialize</code> 和 <code>add_child</code> 方法：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> initialize \</span><br><span class="line">  --module fields \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br><span class="line">  - ID: 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> add_child \</span><br><span class="line">  --module fields \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --args 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 --gas-budget 30000</span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果</span></span><br><span class="line">----- Transaction Effects ----</span><br><span class="line">Status : Success</span><br><span class="line">Created Objects:</span><br><span class="line">  - ID: 0xdf694f282f739f328325bc922b3083bd45f31cae , Owner: Object ID: ( 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 )</span><br><span class="line">Mutated Objects:</span><br><span class="line">  - ID: 0x55536ca8123ffb606398da9f7d2472888ca5bfd1 , Owner: Object ID: ( 0xdf694f282f739f328325bc922b3083bd45f31cae )</span><br><span class="line">  - ID: 0xf1206f0f7d97908aae907c23d69a4cd97120dc82 , Owner: Account Address ( 0xf28e73e59f2305edf4df88756f78fa1f5d7e78b0 )</span><br></pre></td></tr></table></figure>
<p>可以通过 <code>sui_getDynamicFields</code> 方法查看添加的字段：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">'Content-Type: application/json'</span> https://fullnode.devnet.sui.io:443 -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">  "jsonrpc": "2.0",</span></span><br><span class="line"><span class="string">  "id": 1,</span></span><br><span class="line"><span class="string">  "method": "sui_getDynamicFields",</span></span><br><span class="line"><span class="string">  "params":[</span></span><br><span class="line"><span class="string">      "0xf1206f0f7d97908aae907c23d69a4cd97120dc82"</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre></td></tr></table></figure>
<p>结果：</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"jsonrpc"</span>: <span class="string">"2.0"</span>,</span><br><span class="line">    <span class="attr">"result"</span>: &#123;</span><br><span class="line">        <span class="attr">"data"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">"name"</span>: <span class="string">"vector[99u8, 104u8, 105u8, 108u8, 100u8]"</span>,</span><br><span class="line">                <span class="attr">"type"</span>: <span class="string">"DynamicObject"</span>,</span><br><span class="line">                <span class="attr">"objectType"</span>: <span class="string">"0xee2961ee26916285ebef57c68caaa5f67a3d8dbd::fields::Child"</span>,</span><br><span class="line">                <span class="attr">"objectId"</span>: <span class="string">"0x55536ca8123ffb606398da9f7d2472888ca5bfd1"</span>,</span><br><span class="line">                <span class="attr">"version"</span>: <span class="number">1621</span>,</span><br><span class="line">                <span class="attr">"digest"</span>: <span class="string">"GNSaPghN+tRBkxKiVhQCn9jVBkjYV4RU4oF+c4CUGJM="</span></span><br><span class="line">            &#125;</span><br><span class="line">        ],</span><br><span class="line">        <span class="attr">"nextCursor"</span>: <span class="literal">null</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">"id"</span>: <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>name</code> 为 <code>“child”</code> 。同时，对于对象 ID <code>0x55536ca8123ffb606398da9f7d2472888ca5bfd1</code>，我们仍然能从链上追踪对应信息。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -H <span class="string">'Content-Type: application/json'</span> https://fullnode.devnet.sui.io:443 -d <span class="string">'&#123;</span></span><br><span class="line"><span class="string">  "jsonrpc": "2.0",</span></span><br><span class="line"><span class="string">  "id": 1,</span></span><br><span class="line"><span class="string">  "method": "sui_getObject",</span></span><br><span class="line"><span class="string">  "params":[</span></span><br><span class="line"><span class="string">      "0x55536ca8123ffb606398da9f7d2472888ca5bfd1"</span></span><br><span class="line"><span class="string">  ]</span></span><br><span class="line"><span class="string">&#125;'</span></span><br></pre></td></tr></table></figure>
<h3><span id="ji-he-shu-ju-lei-xing">集合数据类型</span></h3>
<p>接下来，我们介绍几种基于 dynamic field 的集合数据类型。</p>
<p>前面介绍过，带有 dynamic field 的对象可以被删除，但是这对于链上集合类型来说这是不希望发生的，因为链上集合类型可能将无限多的键值对作为 dynamic field 保存。因此，在 Sui 提供了两种集合类型： <code>Table</code> 和 <code>Bag</code>，两者都基于 dynamic field 构建的映射类型的数据结构，但是额外支持计算它们包含的条目数，并防止在非空时意外删除。</p>
<p><code>Table</code> 和 <code>Bag</code> 的区别在于，Table 是同质（*homogeneous）*映射，所以的键必须是同一个类型，所以的值也必须是同一个类型，而 Bag 是异质（<em>heterogeneous</em>）映射，可以存储任意类型的键值对。</p>
<p>同时，Sui 标准库中还包含对象版本的 <code>Table</code> 和 <code>Bag</code>： <code>ObjectTable</code> 和 <code>ObjectBag</code>，区别在于前者可以将任何 <code>store</code> 能力的值保存，但从外部存储查看时，作为值存储的对象将被隐藏，后者只能将对象作为值存储，但可以从外部存储中通过 ID 访问这些对象。</p>
<p>与之前介绍过的 <code>vec_map</code> 相比，<code>table</code> 更适合用来处理包含大量映射的情况。</p>
<h3><span id="table">Table</span></h3>
<p>下面我们通过示例来展示对 table 的基本操作：</p>
<ul>
<li>添加元素： <code>add</code></li>
<li>读取和修改元素： <code>borrow</code>，<code>borrow_mut</code></li>
<li>删除元素： <code>delete</code></li>
<li>元素长度： <code>length</code></li>
<li>判断存在性：<code>contains</code></li>
</ul>
<p>Object table 的操作与 table 类似。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::tables &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;<span class="keyword">Self</span>, TxContext&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::table::&#123;<span class="keyword">Self</span>, Table&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EChildAlreadyExists: <span class="built_in">u64</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> EChildNotExists: <span class="built_in">u64</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Parent</span></span> has key &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        children: Table&lt;<span class="built_in">u64</span>, Child&gt;,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Child</span></span> has key, store &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        age: <span class="built_in">u64</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 创建 Parent 对象</span></span><br><span class="line">    public entry fun initialize(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        transfer::transfer(</span><br><span class="line">            Parent &#123; id: object::new(ctx), children: table::new(ctx) &#125;,</span><br><span class="line">            tx_context::sender(ctx)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public fun child_age(child: &amp;Child): <span class="built_in">u64</span> &#123;</span><br><span class="line">        child.age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 查看</span></span><br><span class="line">    public fun child_age_via_parent(parent: &amp;Parent, index: <span class="built_in">u64</span>): <span class="built_in">u64</span> &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(!table::contains(&amp;parent.children, index), EChildNotExists);</span><br><span class="line">        table::borrow(&amp;parent.children, index).age</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 获取长度</span></span><br><span class="line">    public fun child_size_via_parent(parent: &amp;Parent): <span class="built_in">u64</span> &#123;</span><br><span class="line">        table::length(&amp;parent.children)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加</span></span><br><span class="line">    public entry fun add_child(parent: &amp;<span class="keyword">mut</span> Parent, index: <span class="built_in">u64</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(table::contains(&amp;parent.children, index), EChildAlreadyExists);</span><br><span class="line">        table::add(&amp;<span class="keyword">mut</span> parent.children, index, Child &#123; id: object::new(ctx), value: <span class="number">0</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 修改</span></span><br><span class="line">    public fun mutate_child(child: &amp;<span class="keyword">mut</span> Child) &#123;</span><br><span class="line">        child.age = child.age + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun mutate_child_via_parent(parent: &amp;<span class="keyword">mut</span> Parent, index: <span class="built_in">u64</span>) &#123;</span><br><span class="line">        mutate_child(table::borrow_mut(&amp;<span class="keyword">mut</span> parent.children, index));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 删除</span></span><br><span class="line">    public entry fun delete_child(parent: &amp;<span class="keyword">mut</span> Parent, index: <span class="built_in">u64</span>) &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(!table::contains(&amp;parent.children, index), EChildNotExists);</span><br><span class="line">        <span class="keyword">let</span> Child &#123; id, age: _ &#125; = table::remove(</span><br><span class="line">            &amp;<span class="keyword">mut</span> parent.children,</span><br><span class="line">            index</span><br><span class="line">        );</span><br><span class="line">        object::delete(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="bag">Bag</span></h3>
<p>Bag 的操作与 table 的操作接口类似：</p>
<ul>
<li>添加元素： <code>add</code></li>
<li>读取和修改元素： <code>borrow</code>，<code>borrow_mut</code></li>
<li>删除元素： <code>delete</code></li>
<li>元素长度： <code>length</code></li>
<li>判断存在性：<code>contains</code></li>
</ul>
<p>这里我们仅展示添加不同类型的键值对。</p>
<p><code>Object_bag</code> 的操作与 <code>bag</code> 类似。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::bags &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::object::&#123;<span class="keyword">Self</span>, UID&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::transfer;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::&#123;<span class="keyword">Self</span>, TxContext&#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::bag::&#123;<span class="keyword">Self</span>, Bag&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> EChildAlreadyExists: <span class="built_in">u64</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> EChildNotExists: <span class="built_in">u64</span> = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Parent</span></span> has key &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        children: Bag,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Child1</span></span> has key, store &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        value: <span class="built_in">u64</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Child2</span></span> has key, store &#123;</span><br><span class="line">        id: UID,</span><br><span class="line">        value: <span class="built_in">u64</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public entry fun initialize(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        transfer::transfer(</span><br><span class="line">            Parent &#123; id: object::new(ctx), children: bag::new(ctx) &#125;,</span><br><span class="line">            tx_context::sender(ctx)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加第一种类型</span></span><br><span class="line">    public entry fun add_child1(parent: &amp;<span class="keyword">mut</span> Parent, index: <span class="built_in">u64</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(bag::contains(&amp;parent.children, index), EChildAlreadyExists);</span><br><span class="line">        bag::add(&amp;<span class="keyword">mut</span> parent.children, index, Child1 &#123; id: object::new(ctx), value: <span class="number">0</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 添加第二种类型</span></span><br><span class="line">    public entry fun add_child2(parent: &amp;<span class="keyword">mut</span> Parent, index: <span class="built_in">u64</span>, ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="built_in">assert!</span>(bag::contains(&amp;parent.children, index), EChildAlreadyExists);</span><br><span class="line">        bag::add(&amp;<span class="keyword">mut</span> parent.children, index, Child2 &#123; id: object::new(ctx), value: <span class="number">0</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="linkedtable">LinkedTable</span></h3>
<p><code>linked_table</code> 是另一种使用 dynamic field 实现的数据结构，它与 <code>table</code> 类似，除此之外，它还支持值的有序插入和删除。因此，除了 table  类似的基础操作方法，还包含 <code>front</code>，<code>back</code>，<code>push_front</code>，<code>push_back</code>，<code>pop_front</code>，<code>pop_back</code>等操作，对于每一个键，也可以通过 <code>prev</code> 和 <code>next</code> 获取前一个和后一个插入的键。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::linked_tables &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::linked_table::&#123;</span><br><span class="line">        <span class="keyword">Self</span>,</span><br><span class="line">        push_front,</span><br><span class="line">        push_back,</span><br><span class="line">        borrow,</span><br><span class="line">        borrow_mut,</span><br><span class="line">        remove,</span><br><span class="line">        pop_front,</span><br><span class="line">        pop_back,</span><br><span class="line">        contains,</span><br><span class="line">        is_empty,</span><br><span class="line">        destroy_empty</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::TxContext;</span><br><span class="line"></span><br><span class="line">    public entry fun simple_all_functions(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> table = linked_table::new(ctx);</span><br><span class="line">        <span class="comment">// 添加字段</span></span><br><span class="line">        push_back(&amp;<span class="keyword">mut</span> table, <span class="string">b"hello"</span>, <span class="number">0</span>);</span><br><span class="line">        push_back(&amp;<span class="keyword">mut</span> table, <span class="string">b"goodbye"</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// [b"hello", b"goodbye"]</span></span><br><span class="line">        <span class="comment">// 检查是否存在</span></span><br><span class="line">        <span class="built_in">assert!</span>(contains(&amp;table, <span class="string">b"hello"</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(contains(&amp;table, <span class="string">b"goodbye"</span>), <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(!is_empty(&amp;table), <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 修改</span></span><br><span class="line">        *borrow_mut(&amp;<span class="keyword">mut</span> table, <span class="string">b"hello"</span>) = *borrow(&amp;table, <span class="string">b"hello"</span>) * <span class="number">2</span>;</span><br><span class="line">        *borrow_mut(&amp;<span class="keyword">mut</span> table, <span class="string">b"goodbye"</span>) = *borrow(&amp;table, <span class="string">b"goodbye"</span>) * <span class="number">2</span>;</span><br><span class="line">        <span class="comment">// 检查修改之后的值</span></span><br><span class="line">        <span class="built_in">assert!</span>(*borrow(&amp;table, <span class="string">b"hello"</span>) == <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(*borrow(&amp;table, <span class="string">b"goodbye"</span>) == <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 插入头部</span></span><br><span class="line">        push_front(&amp;<span class="keyword">mut</span> table, <span class="string">b"!!!"</span>, <span class="number">2</span>);</span><br><span class="line">        <span class="comment">// b"!!!", b"hello", b"goodbye"]</span></span><br><span class="line">        <span class="comment">// 在末尾添加</span></span><br><span class="line">        push_back(&amp;<span class="keyword">mut</span> table, <span class="string">b"?"</span>, <span class="number">3</span>);</span><br><span class="line">        <span class="comment">// [b"!!!", b"hello", b"goodbye", b"?"]</span></span><br><span class="line">        <span class="comment">// 从头部弹出</span></span><br><span class="line">        <span class="keyword">let</span> (front_k, front_v) = pop_front(&amp;<span class="keyword">mut</span> table);</span><br><span class="line">        <span class="built_in">assert!</span>(front_k == <span class="string">b"!!!"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(front_v == <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 从中间删除</span></span><br><span class="line">        <span class="built_in">assert!</span>(remove(&amp;<span class="keyword">mut</span> table, <span class="string">b"goodbye"</span>) == <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// [b"hello", b"?"]</span></span><br><span class="line">        <span class="comment">// 从末尾删除</span></span><br><span class="line">        <span class="keyword">let</span> (back_k, back_v) = pop_back(&amp;<span class="keyword">mut</span> table);</span><br><span class="line">        <span class="built_in">assert!</span>(back_k == <span class="string">b"?"</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(back_v == <span class="number">3</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 移出值并检查</span></span><br><span class="line">        <span class="built_in">assert!</span>(remove(&amp;<span class="keyword">mut</span> table, <span class="string">b"hello"</span>) == <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        <span class="comment">// 检查不存在</span></span><br><span class="line">        <span class="built_in">assert!</span>(is_empty(&amp;table), <span class="number">0</span>);</span><br><span class="line">        destroy_empty(table);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3><span id="tablevec">TableVec</span></h3>
<p>最后，我们介绍一种基于 <code>table</code> 的数据结构 <code>table_vec</code>。从名字就可以看出，<code>table_vec</code> 是使用 <code>table</code> 实现的可扩展 <code>vector</code>，它使用元素在 <code>vector</code> 的索引作为 <code>table</code> 中的键进行存储。<code>table_vec</code> 提供了与 <code>vector</code> 类似的操作方法。</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">module ds::table_vecs &#123;</span><br><span class="line">    <span class="keyword">use</span> sui::table_vec;</span><br><span class="line">    <span class="keyword">use</span> sui::tx_context::TxContext;</span><br><span class="line"></span><br><span class="line">    public entry fun example(ctx: &amp;<span class="keyword">mut</span> TxContext) &#123;</span><br><span class="line">        <span class="keyword">let</span> vec = table_vec::singleton&lt;<span class="built_in">u64</span>&gt;(<span class="number">1</span>, ctx);</span><br><span class="line"></span><br><span class="line">        table_vec::push_back(&amp;<span class="keyword">mut</span> vec, <span class="number">2</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(table_vec::length(&amp;vec) == <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">let</span> v = table_vec::borrow_mut(&amp;<span class="keyword">mut</span> vec, <span class="number">1</span>);</span><br><span class="line">        *v = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(table_vec::pop_back(&amp;<span class="keyword">mut</span> vec) == <span class="number">3</span>, <span class="number">1</span>);</span><br><span class="line">        <span class="built_in">assert!</span>(table_vec::pop_back(&amp;<span class="keyword">mut</span> vec) == <span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="built_in">assert!</span>(table_vec::is_empty(&amp;vec), <span class="number">2</span>);</span><br><span class="line">        table_vec::destroy_empty(vec);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译并运行示例：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sui client call \</span><br><span class="line">  --<span class="keyword">function</span> example \</span><br><span class="line">  --module table_vecs \</span><br><span class="line">  --package <span class="variable">$&#123;package_id&#125;</span> \</span><br><span class="line">  --gas-budget 30000</span><br></pre></td></tr></table></figure>
<p>至此，我们介绍完了 Sui Move 中主要的数据类型及其使用方法，希望大家学习和理解 Sui Move 有一定的帮助。</p>
<h3><span id="comments">Comments</span></h3>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/%E6%8A%80%E6%9C%AF/">#技术</a><a href="/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/">#区块链</a></p></article></div><div class="post-copyright"><blockquote><p>版权声明：本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">署名-相同方式共享 | CC BY-SA 4.0 </a>许可协议。</p></blockquote></div><footer><div class="paginator"><a href="/qiwihui-blog-175/" class="prev">PREV</a><a href="/qiwihui-blog-171/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'blog-qiwihui-com';
var disqus_identifier = 'qiwihui-blog-172/';
var disqus_title = 'Sui 数据类型讲解';
var disqus_url = 'https://qiwihui.com/qiwihui-blog-172/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-qiwihui-com.disqus.com/count.js" async></script><!-- block copyright--></footer></div><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ["script","noscript","style","textarea","code","pre"]
    }
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46660488-3",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>