<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 用 Rust Actix-web 写一个 Todo 应用（四）── 测试 · QIWIHUI</title><meta name="description" content="用 Rust Actix-web 写一个 Todo 应用（四）── 测试 - qiwihui"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/nella.css"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.12/css/all.css" integrity="sha384-G0fIWCsCzJIMAVNQPfjH08cyYaUtMwjJwqiRKxxE/rx96Uroj1BtIQ6MLJuheaO9" crossorigin="anonymous"><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
google_ad_client: "ca-pub-8935595858652656",
enable_page_level_ads: true
});
</script><link rel="search" type="application/opensearchdescription+xml" href="https://qiwihui.com/atom.xml" title="QIWIHUI"><meta property="og:site_name" content="QIWIHUI"><meta property="og:url" content="https://qiwihui.com/qiwihui-blog-108/index.html"><meta property="og:title" content="用 Rust Actix-web 写一个 Todo 应用（四）── 测试"><meta property="og:description" content="用 Rust Actix-web 写一个 Todo 应用（四）── 测试"><meta property="og:type" content="article"><script src="//code.jquery.com/jquery-2.2.4.min.js" integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44=" crossorigin="anonymous"></script><meta name="generator" content="Hexo 4.2.1"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/images/avatar.jpg" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="/about/" target="_self" class="nav-list-link">ABOUT</a></li><li class="nav-list-item"><a href="/search/" target="_self" class="nav-list-link">SEARCH</a></li><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">HOME</a></li><li class="nav-list-item"><a href="/projects/" target="_self" class="nav-list-link">PROJECTS</a></li><li class="nav-list-item"><a href="/tags/" target="_self" class="nav-list-link">TAGS</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="/links/" target="_self" class="nav-list-link">LINKS</a></li><!--li.nav-list-item--><!--    a.nav-list-link(class="search" href=url_for("search") target="_self") SEARCH--></ul></header><main class="container"></main><div class="post"><article class="post-block"><h1 class="post-title">用 Rust Actix-web 写一个 Todo 应用（四）── 测试</h1><div class="post-info">Aug 13, 2022<span class="categories"><i class="fa fa-bookmark" aria-hidden="true"></i></span><a href="/categories/%E6%8A%80%E6%9C%AF/" class="post-category">#技术</a><span>8 min. read</span></div><div class="post-content"><p>对程序进行集成测试。</p>
<a id="more"></a>
<h2><span id="ce-shi-qian-chong-gou">测试前重构</span></h2>
<p>在测试前，先简单重构，方便构建测试。</p>
<h3><span id="1-jiang-lu-you-chou-qu-cheng-dan-du-de-mo-kuai">1. 将路由抽取成单独的模块</span></h3>
<p><code>routes.rs</code></p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::handlers;</span><br><span class="line"><span class="keyword">use</span> actix_web::web;</span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">routes</span></span>(cfg: &amp;<span class="keyword">mut</span> web::ServiceConfig) &#123;</span><br><span class="line">    cfg.service(handlers::hello)</span><br><span class="line">        .route(<span class="string">"/todos&#123;_:/?&#125;"</span>, web::get().to(handlers::todos))</span><br><span class="line">        .route(<span class="string">"/todos&#123;_:/?&#125;"</span>, web::post().to(handlers::create_todo))</span><br><span class="line">        .route(<span class="string">"/todos/&#123;list_id&#125;&#123;_:/?&#125;"</span>, web::get().to(handlers::todo))</span><br><span class="line">        .route(</span><br><span class="line">            <span class="string">"/todos/&#123;list_id&#125;/items&#123;_:/?&#125;"</span>,</span><br><span class="line">            web::get().to(handlers::items),</span><br><span class="line">        )</span><br><span class="line">        .route(</span><br><span class="line">            <span class="string">"/todos/&#123;list_id&#125;/items&#123;_:/?&#125;"</span>,</span><br><span class="line">            web::post().to(handlers::create_item),</span><br><span class="line">        )</span><br><span class="line">        .route(</span><br><span class="line">            <span class="string">"/todos/&#123;list_id&#125;/items/&#123;item_id&#125;&#123;_:/?&#125;"</span>,</span><br><span class="line">            web::get().to(handlers::get_item),</span><br><span class="line">        )</span><br><span class="line">        .route(</span><br><span class="line">            <span class="string">"/todos/&#123;list_id&#125;/items/&#123;item_id&#125;&#123;_:/?&#125;"</span>,</span><br><span class="line">            web::put().to(handlers::check_todo),</span><br><span class="line">        );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>并将原来的 <code>hello</code> 视图移至 <code>handlers.rs</code> 中，此时 <code>main.rs</code> 中路由修改为如下：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">+<span class="keyword">mod</span> routes;</span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line">+<span class="keyword">use</span> routes::routes;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// ... 转移</span></span><br><span class="line">-<span class="meta">#[get(<span class="meta-string">"/"</span>)]</span></span><br><span class="line">-<span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">hello</span></span>() -&gt; <span class="keyword">impl</span> Responder &#123;</span><br><span class="line">-    <span class="built_in">format!</span>(<span class="string">"Hello world!"</span>)</span><br><span class="line">-&#125;</span><br><span class="line">-</span><br><span class="line"> <span class="meta">#[actix_web::main]</span></span><br><span class="line"> <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; io::<span class="built_in">Result</span>&lt;()&gt; &#123;</span><br><span class="line">     dotenv().ok();</span><br><span class="line">@@ -<span class="number">34</span>,<span class="number">26</span> +<span class="number">31</span>,<span class="number">7</span> @@ <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">main</span></span>() -&gt; io::<span class="built_in">Result</span>&lt;()&gt; &#123;</span><br><span class="line">         App::new()</span><br><span class="line">             .data(AppState &#123; pool: pool.clone() &#125;)</span><br><span class="line">             .wrap(middleware::Logger::default())</span><br><span class="line"><span class="comment">// ... 转移</span></span><br><span class="line">-            .service(hello)</span><br><span class="line">-            .route(<span class="string">"/todos&#123;_:/?&#125;"</span>, web::get().to(handlers::todos))</span><br><span class="line">-            .route(<span class="string">"/todos&#123;_:/?&#125;"</span>, web::post().to(handlers::create_todo))</span><br><span class="line">-            .route(<span class="string">"/todos/&#123;list_id&#125;&#123;_:/?&#125;"</span>, web::get().to(handlers::todo))</span><br><span class="line">-            .route(</span><br><span class="line">-                <span class="string">"/todos/&#123;list_id&#125;/items&#123;_:/?&#125;"</span>,</span><br><span class="line">-                web::get().to(handlers::items),</span><br><span class="line">-            )</span><br><span class="line">-            .route(</span><br><span class="line">-                <span class="string">"/todos/&#123;list_id&#125;/items&#123;_:/?&#125;"</span>,</span><br><span class="line">-                web::post().to(handlers::create_item),</span><br><span class="line">-            )</span><br><span class="line">-            .route(</span><br><span class="line">-                <span class="string">"/todos/&#123;list_id&#125;/items/&#123;item_id&#125;&#123;_:/?&#125;"</span>,</span><br><span class="line">-                web::get().to(handlers::get_item),</span><br><span class="line">-            )</span><br><span class="line">-            .route(</span><br><span class="line">-                <span class="string">"/todos/&#123;list_id&#125;/items/&#123;item_id&#125;&#123;_:/?&#125;"</span>,</span><br><span class="line">-                web::put().to(handlers::check_todo),</span><br><span class="line">-            )</span><br><span class="line">+            .configure(routes)</span><br><span class="line">     &#125;)</span><br><span class="line">     .bind(<span class="built_in">format!</span>(<span class="string">"&#123;&#125;:&#123;&#125;"</span>, cfg.server.host, cfg.server.port))?</span><br><span class="line">     .run()</span><br></pre></td></tr></table></figure>
<h3><span id="2-zeng-jia-init-pool-fang-fa">2. 增加 <code>init_pool</code> 方法</span></h3>
<p>首先我们添加一个配置错误处理：</p>
<p><code>errors.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">@@ -<span class="number">10</span>,<span class="number">6</span> +<span class="number">12</span>,<span class="number">7</span> @@ <span class="keyword">pub</span> <span class="class"><span class="keyword">enum</span> <span class="title">Error</span></span> &#123;</span><br><span class="line">     InternalServerError(<span class="built_in">String</span>),</span><br><span class="line">     NotFound(<span class="built_in">String</span>),</span><br><span class="line">     PoolError(<span class="built_in">String</span>),</span><br><span class="line">+    ConfigError(<span class="built_in">String</span>),</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>在 <code>config.rs</code> 中增加 <code>init_pool</code> 方法：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::errors::Error;</span><br><span class="line"><span class="keyword">use</span> deadpool_postgres::Pool;</span><br><span class="line"><span class="keyword">use</span> tokio_postgres::NoTls;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... 省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="function"><span class="keyword">fn</span> <span class="title">init_pool</span></span>(config: &amp;Config) -&gt; <span class="built_in">Result</span>&lt;Pool, Error&gt; &#123;</span><br><span class="line">    <span class="keyword">match</span> config.pg.create_pool(NoTls) &#123;</span><br><span class="line">        <span class="literal">Ok</span>(pool) =&gt; <span class="literal">Ok</span>(pool),</span><br><span class="line">        <span class="literal">Err</span>(_) =&gt; <span class="literal">Err</span>(Error::ConfigError(<span class="string">"config error"</span>.into())),</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2><span id="ce-shi">测试</span></h2>
<p>首先，增加运行时环境包:</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dependencies]</span></span><br><span class="line"><span class="attr">actix-rt</span> = <span class="string">"1"</span></span><br></pre></td></tr></table></figure>
<p>创建 <code>tests</code> 目录，并添加如下文件，</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/tests/</span><br><span class="line">├── handlers.rs</span><br><span class="line">├── helpers.rs</span><br><span class="line">└── mod.rs</span><br></pre></td></tr></table></figure>
<p>在 <a href="http://main.rs" target="_blank" rel="noopener">main.rs</a> 中增加 <code>tests</code> 模块：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="meta">#[cfg(test)]</span></span><br><span class="line"><span class="keyword">mod</span> tests;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ...</span></span><br></pre></td></tr></table></figure>
<p>其中，<code>handlers.rs</code> 用于集成测试，<code>helpers.rs</code> 提供基本的测试方法。</p>
<p><code>mod.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">mod</span> handlers;</span><br><span class="line"><span class="keyword">mod</span> helpers;</span><br></pre></td></tr></table></figure>
<p>我们先测试一下 <code>/</code> 路由下 <code>hello world</code> 的功能。</p>
<p><code>helpers.rs</code> 中增加基本的 <code>get</code> 测试方法：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::routes::routes;</span><br><span class="line"><span class="keyword">use</span> actix_web::dev::ServiceResponse;</span><br><span class="line"><span class="keyword">use</span> actix_web::&#123;test, App&#125;;</span><br><span class="line"><span class="comment">// 测试get</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">test_get</span></span>(route: &amp;<span class="built_in">str</span>) -&gt; ServiceResponse &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> app = test::init_service(App::new().configure(routes)).<span class="keyword">await</span>;</span><br><span class="line">    test::call_service(&amp;<span class="keyword">mut</span> app, test::TestRequest::get().uri(route).to_request()).<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// assert get 方法</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">assert_get</span></span>(route: &amp;<span class="built_in">str</span>) -&gt; ServiceResponse &#123;</span><br><span class="line">    <span class="keyword">let</span> response = test_get(route).<span class="keyword">await</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(response.status().is_success());</span><br><span class="line">    response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>handlers.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::tests::helpers::assert_get;</span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_rt::test]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">test_hello_world</span></span>() &#123;</span><br><span class="line">    assert_get(<span class="string">"/"</span>).<span class="keyword">await</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行测试：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo <span class="built_in">test</span></span></span><br><span class="line"></span><br><span class="line">running 1 test</span><br><span class="line">test tests::handlers::tests::test_hello_world ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 1 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br></pre></td></tr></table></figure>
<p>可以看到这个测试成功了。</p>
<h2><span id="ce-shi-post-jie-kou">测试 <code>POST</code> 接口</span></h2>
<p>我们增加 <code>lazy_static</code> 和 <code>serde_json</code> 库，前者用于延后执行，后者用于方便处理 json 数据。</p>
<figure class="highlight toml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="section">[dev-dependencies]</span></span><br><span class="line"><span class="attr">lazy_static</span> = <span class="string">"1.4.0"</span></span><br><span class="line"><span class="attr">serde_json</span> = <span class="string">"1.0.48"</span></span><br></pre></td></tr></table></figure>
<p>在集成测试中，我们将使用数据库链接进行测试，首先 <code>helpers.rs</code> 中增加 <code>AppState</code> 用于测试：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">lazy_static! &#123;</span><br><span class="line">    <span class="keyword">pub</span> <span class="keyword">static</span> <span class="keyword">ref</span> APP_STATE: models::AppState = &#123;</span><br><span class="line">        dotenv().ok();</span><br><span class="line">        <span class="keyword">let</span> config = Config::from_env().unwrap();</span><br><span class="line">        <span class="keyword">let</span> pool = init_pool(&amp;config).unwrap();</span><br><span class="line">        models::AppState &#123; pool: pool.clone() &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以及对应的 post 测试断言：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 其中 `AppState` 需要增加 `Clone` 宏</span></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">test_post</span></span>&lt;T: Serialize&gt;(route: &amp;<span class="built_in">str</span>, params: T) -&gt; ServiceResponse &#123;</span><br><span class="line">    <span class="keyword">let</span> <span class="keyword">mut</span> app = test::init_service(App::new().data(APP_STATE.clone()).configure(routes)).<span class="keyword">await</span>;</span><br><span class="line">    test::call_service(</span><br><span class="line">        &amp;<span class="keyword">mut</span> app,</span><br><span class="line">        test::TestRequest::post()</span><br><span class="line">            .set_json(&amp;params)</span><br><span class="line">            .uri(route)</span><br><span class="line">            .to_request(),</span><br><span class="line">    )</span><br><span class="line">    .<span class="keyword">await</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">pub</span> <span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">assert_post</span></span>&lt;T: Serialize&gt;(route: &amp;<span class="built_in">str</span>, params: T) -&gt; ServiceResponse &#123;</span><br><span class="line">    <span class="keyword">let</span> response = test_post(route, params).<span class="keyword">await</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(response.status().is_success());</span><br><span class="line">    response</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后，我们增加一个创建 todo_list 的测试，包含创建并检测是否存在：</p>
<p><code>tests/handlers.rs</code>：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="meta">#[actix_rt::test]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">test_create_todos</span></span>() &#123;</span><br><span class="line">    <span class="keyword">let</span> todo_title = <span class="string">"Create todo List"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> params = CreateTodoList &#123;</span><br><span class="line">        title: todo_title.into(),</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">let</span> response = assert_post(<span class="string">"/todos"</span>, params).<span class="keyword">await</span>;</span><br><span class="line">    <span class="comment">// 检查放返回数据</span></span><br><span class="line">    <span class="keyword">let</span> body = test::read_body(response).<span class="keyword">await</span>;</span><br><span class="line">    <span class="keyword">let</span> try_created: <span class="built_in">Result</span>&lt;models::TodoList, serde_json::error::Error&gt; =</span><br><span class="line">        serde_json::from_slice(&amp;body);</span><br><span class="line">    <span class="built_in">assert!</span>(try_created.is_ok(), <span class="string">"Response couldn't not be parsed"</span>);</span><br><span class="line">    <span class="comment">// 使用接口查看数据</span></span><br><span class="line">    <span class="keyword">let</span> created_list = try_created.unwrap();</span><br><span class="line">    <span class="keyword">let</span> resp = assert_get(<span class="string">"/todos"</span>).<span class="keyword">await</span>;</span><br><span class="line">    <span class="keyword">let</span> todos: <span class="built_in">Vec</span>&lt;models::TodoList&gt; = test::read_body_json(resp).<span class="keyword">await</span>;</span><br><span class="line">    <span class="keyword">let</span> maybe_list = todos.iter().find(|todo| todo.id == created_list.id);</span><br><span class="line">    <span class="built_in">assert!</span>(maybe_list.is_some(), <span class="string">"Item not found!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中 <code>CreateTodoList</code> 需要增加 <code>Clone</code> 宏，才能在传入 <code>params</code> 参数时正常使用。</p>
<p>运行测试，查看结果</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> cargo <span class="built_in">test</span></span></span><br><span class="line"></span><br><span class="line">running 2 tests</span><br><span class="line">test tests::handlers::test_hello_world ... ok</span><br><span class="line">test tests::handlers::test_create_todos ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. 2 passed; 0 failed; 0 ignored; 0 measured; 0 filtered out</span><br></pre></td></tr></table></figure>
<h2><span id="ce-shi-get-jie-kou">测试 <code>GET</code> 接口</span></h2>
<p>最后添加 <code>GET</code> 集成测试：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line"><span class="keyword">use</span> crate::db::create_todo;</span><br><span class="line"><span class="keyword">use</span> crate::tests::helpers::&#123;assert_get, assert_post, APP_STATE&#125;;</span><br><span class="line"><span class="keyword">use</span> deadpool_postgres::Client;</span><br><span class="line"><span class="comment">// ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#[actix_rt::test]</span></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">fn</span> <span class="title">test_get_todos</span></span>() &#123;</span><br><span class="line">    <span class="comment">// create data in db</span></span><br><span class="line">    <span class="keyword">let</span> todo_title = <span class="string">"New Todo List"</span>;</span><br><span class="line">    <span class="keyword">let</span> client: Client = APP_STATE</span><br><span class="line">        .pool</span><br><span class="line">        .get()</span><br><span class="line">        .<span class="keyword">await</span></span><br><span class="line">        .expect(<span class="string">"Error connecting to the database"</span>);</span><br><span class="line">    <span class="keyword">let</span> new_todo = create_todo(&amp;client, todo_title.into()).<span class="keyword">await</span>;</span><br><span class="line">    <span class="built_in">assert!</span>(new_todo.is_ok(), <span class="string">"Failed to create new test todo"</span>);</span><br><span class="line">    <span class="comment">// get and check</span></span><br><span class="line">    <span class="keyword">let</span> new_todo = new_todo.unwrap();</span><br><span class="line">    <span class="keyword">let</span> response = assert_get(<span class="string">"/todos"</span>).<span class="keyword">await</span>;</span><br><span class="line">    <span class="keyword">let</span> todos: <span class="built_in">Vec</span>&lt;models::TodoList&gt; = test::read_body_json(response).<span class="keyword">await</span>;</span><br><span class="line">    <span class="keyword">let</span> maybe_list = todos.iter().find(|todo| todo.id == new_todo.id);</span><br><span class="line">    <span class="built_in">assert!</span>(maybe_list.is_some(), <span class="string">"Item not found!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>运行结果：</p>
<figure class="highlight rust"><table><tr><td class="code"><pre><span class="line">$ cargo test</span><br><span class="line"></span><br><span class="line">running <span class="number">3</span> tests</span><br><span class="line">test tests::handlers::test_hello_world ... ok</span><br><span class="line">test tests::handlers::test_get_todos ... ok</span><br><span class="line">test tests::handlers::test_create_todos ... ok</span><br><span class="line"></span><br><span class="line">test result: ok. <span class="number">3</span> passed; <span class="number">0</span> failed; <span class="number">0</span> ignored; <span class="number">0</span> measured; <span class="number">0</span> filtered out</span><br></pre></td></tr></table></figure>
<h2><span id="xiao-jie">小结</span></h2>
<ol>
<li>简单重构，抽象工具函数；</li>
<li>抽象测试工具函数；</li>
<li>创建 <code>GET</code> 和 <code>POST</code> 测试。</li>
</ol>
<h2><span id="can-kao-wen-dang-he-xiang-mu">参考文档和项目</span></h2>
<ol>
<li><a href="https://www.youtube.com/watch?v=gQwA0g0NNSI" target="_blank" rel="noopener">Creating a simple TODO service with Actix</a></li>
<li><a href="actix.rs">actix-web 官方文档</a></li>
<li><a href="https://github.com/actix/examples" target="_blank" rel="noopener">官方 actix-web 示例</a></li>
</ol>
<blockquote>
<p>GitHub repo: <a href="https://github.com/qiwihui/blog" target="_blank" rel="noopener">qiwihui/blog</a></p>
<p>Follow me: <a href="https://github.com/qiwihui" target="_blank" rel="noopener">@qiwihui</a></p>
<p>Site: <a href="https://qiwihui.com">QIWIHUI</a></p>
</blockquote>
<h3><span id="comments">Comments</span></h3>
</div><p class="post-tags"><i class="fa fa-tags" aria-hidden="true"></i><a href="/tags/%E6%8A%80%E6%9C%AF/">#技术</a><a href="/tags/Rust/">#Rust</a></p></article></div><div class="post-copyright"><blockquote><p>版权声明：本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">署名-相同方式共享 | CC BY-SA 4.0 </a>许可协议。</p></blockquote></div><footer><div class="paginator"><a href="/qiwihui-blog-109/" class="prev">PREV</a><a href="/qiwihui-blog-118/" class="next">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'blog-qiwihui-com';
var disqus_identifier = 'qiwihui-blog-108/';
var disqus_title = '用 Rust Actix-web 写一个 Todo 应用（四）── 测试';
var disqus_url = 'https://qiwihui.com/qiwihui-blog-108/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//blog-qiwihui-com.disqus.com/count.js" async></script><!-- block copyright--></footer></div><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']],
        processEscapes: true,
        processEnvironments: true,
        skipTags: ["script","noscript","style","textarea","code","pre"]
    }
});
</script><script>(function(b,o,i,l,e,r){b.GoogleAnalyticsObject=l;b[l]||(b[l]=function(){(b[l].q=b[l].q||[]).push(arguments)});b[l].l=+new Date;e=o.createElement(i);r=o.getElementsByTagName(i)[0];e.src='//www.google-analytics.com/analytics.js';r.parentNode.insertBefore(e,r)}(window,document,'script','ga'));ga('create',"UA-46660488-3",'auto');ga('send','pageview');</script><link rel="stylesheet" href="//cdn.datatables.net/1.10.7/css/jquery.dataTables.min.css" media="screen" type="text/css"><script src="//cdn.datatables.net/1.10.7/js/jquery.dataTables.min.js"></script><script>$(function(){$('.datatable').dataTable( {"order": [[ 0, "desc" ]],"iDisplayLength": -1,"lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]} );});</script></body></html>